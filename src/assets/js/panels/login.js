"use strict";import{database,changePanel,addAccount,accountSelect}from"../utils.js";const{Mojang:Mojang}=require("minecraft-java-core"),{ipcRenderer:ipcRenderer}=require("electron");class Login{static id="login";async init(config){this.config=config,this.database=await(new database).init(),this.config.online?this.getOnline():this.getOffline()}getOnline(){console.log("Initializing microsoft Panel..."),console.log("Initializing mojang Panel..."),this.loginMicrosoft(),this.loginMojang(),document.querySelector(".cancel-login").addEventListener("click",(()=>{document.querySelector(".cancel-login").style.display="none",changePanel("settings")}))}getOffline(){console.log("Initializing microsoft Panel..."),console.log("Initializing mojang Panel..."),console.log("Initializing offline Panel..."),this.loginMicrosoft(),this.loginOffline(),document.querySelector(".cancel-login").addEventListener("click",(()=>{document.querySelector(".cancel-login").style.display="none",changePanel("settings")}))}loginMicrosoft(){let microsoftBtn=document.querySelector(".microsoft"),mojangBtn=document.querySelector(".mojang"),cancelBtn=document.querySelector(".cancel-login");microsoftBtn.addEventListener("click",(()=>{microsoftBtn.disabled=!0,mojangBtn.disabled=!0,cancelBtn.disabled=!0,ipcRenderer.invoke("Microsoft-window",this.config.client_id).then((account_connect=>{if(!account_connect)return microsoftBtn.disabled=!1,mojangBtn.disabled=!1,void(cancelBtn.disabled=!1);let account={access_token:account_connect.access_token,client_token:account_connect.client_token,uuid:account_connect.uuid,name:account_connect.name,refresh_token:account_connect.refresh_token,user_properties:account_connect.user_properties,meta:account_connect.meta},profile={uuid:account_connect.uuid,skins:account_connect.profile.skins||[],capes:account_connect.profile.capes||[]};this.database.add(account,"accounts"),this.database.add(profile,"profile"),this.database.update({uuid:"1234",selected:account.uuid},"accounts-selected"),addAccount(account),accountSelect(account.uuid),changePanel("home"),microsoftBtn.disabled=!1,mojangBtn.disabled=!1,cancelBtn.disabled=!1,cancelBtn.style.display="none"})).catch((err=>{console.log(err),microsoftBtn.disabled=!1,mojangBtn.disabled=!1,cancelBtn.disabled=!1}))}))}async loginMojang(){let mailInput=document.querySelector(".Mail"),passwordInput=document.querySelector(".Password"),cancelMojangBtn=document.querySelector(".cancel-mojang"),infoLogin=document.querySelector(".info-login"),loginBtn=document.querySelector(".login-btn");document.querySelector(".mojang").addEventListener("click",(()=>{document.querySelector(".login-card").style.display="none",document.querySelector(".login-card-mojang").style.display="block"})),cancelMojangBtn.addEventListener("click",(()=>{document.querySelector(".login-card").style.display="block",document.querySelector(".login-card-mojang").style.display="none"})),loginBtn.addEventListener("click",(async()=>{if(cancelMojangBtn.disabled=!0,loginBtn.disabled=!0,mailInput.disabled=!0,passwordInput.disabled=!0,infoLogin.innerHTML="Connexion en cours...",""==mailInput.value)return infoLogin.innerHTML="Entrez votre adresse email / Nom d'utilisateur",cancelMojangBtn.disabled=!1,loginBtn.disabled=!1,mailInput.disabled=!1,void(passwordInput.disabled=!1);if(""==passwordInput.value)return infoLogin.innerHTML="Entrez votre mot de passe",cancelMojangBtn.disabled=!1,loginBtn.disabled=!1,mailInput.disabled=!1,void(passwordInput.disabled=!1);let account_connect=await Mojang.login(mailInput.value,passwordInput.value);if(null==account_connect||account_connect.error)return console.log(err),cancelMojangBtn.disabled=!1,loginBtn.disabled=!1,mailInput.disabled=!1,passwordInput.disabled=!1,void(infoLogin.innerHTML="Adresse E-mail ou mot de passe invalide");let account={access_token:account_connect.access_token,client_token:account_connect.client_token,uuid:account_connect.uuid,name:account_connect.name,user_properties:account_connect.user_properties,meta:{type:account_connect.meta.type,offline:account_connect.meta.offline}};this.database.add(account,"accounts"),this.database.update({uuid:"1234",selected:account.uuid},"accounts-selected"),addAccount(account),accountSelect(account.uuid),changePanel("home"),cancelMojangBtn.disabled=!1,cancelMojangBtn.click(),mailInput.value="",loginBtn.disabled=!1,mailInput.disabled=!1,passwordInput.disabled=!1,loginBtn.style.display="block",infoLogin.innerHTML="&nbsp;"}))}async loginOffline(){let mailInput=document.querySelector(".Mail"),passwordInput=document.querySelector(".Password"),cancelMojangBtn=document.querySelector(".cancel-mojang"),infoLogin=document.querySelector(".info-login"),loginBtn=document.querySelector(".login-btn"),mojangBtn=document.querySelector(".mojang");mojangBtn.innerHTML="Offline",mojangBtn.addEventListener("click",(()=>{document.querySelector(".login-card").style.display="none",document.querySelector(".login-card-mojang").style.display="block"})),cancelMojangBtn.addEventListener("click",(()=>{document.querySelector(".login-card").style.display="block",document.querySelector(".login-card-mojang").style.display="none"})),loginBtn.addEventListener("click",(async()=>{if(cancelMojangBtn.disabled=!0,loginBtn.disabled=!0,mailInput.disabled=!0,passwordInput.disabled=!0,infoLogin.innerHTML="Connexion en cours...",""==mailInput.value)return infoLogin.innerHTML="Entrez votre adresse email / Nom d'utilisateur",cancelMojangBtn.disabled=!1,loginBtn.disabled=!1,mailInput.disabled=!1,void(passwordInput.disabled=!1);if(mailInput.value.length<3)return infoLogin.innerHTML="Votre nom d'utilisateur doit avoir au moins 3 caractÃ¨res",cancelMojangBtn.disabled=!1,loginBtn.disabled=!1,mailInput.disabled=!1,void(passwordInput.disabled=!1);let account_connect=await Mojang.login(mailInput.value,passwordInput.value);if(null==account_connect||account_connect.error)return console.log(err),cancelMojangBtn.disabled=!1,loginBtn.disabled=!1,mailInput.disabled=!1,passwordInput.disabled=!1,void(infoLogin.innerHTML="Adresse E-mail ou mot de passe invalide");let account={access_token:account_connect.access_token,client_token:account_connect.client_token,uuid:account_connect.uuid,name:account_connect.name,user_properties:account_connect.user_properties,meta:{type:account_connect.meta.type,online:account_connect.meta.online}};this.database.add(account,"accounts"),this.database.update({uuid:"1234",selected:account.uuid},"accounts-selected"),addAccount(account),accountSelect(account.uuid),changePanel("home"),cancelMojangBtn.disabled=!1,cancelMojangBtn.click(),mailInput.value="",loginBtn.disabled=!1,mailInput.disabled=!1,passwordInput.disabled=!1,loginBtn.style.display="block",infoLogin.innerHTML="&nbsp;"}))}}export default Login;
