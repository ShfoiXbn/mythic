"use strict";import{database,changePanel,accountSelect,Slider}from"../utils.js";const dataDirectory=process.env.APPDATA||("darwin"==process.platform?process.env.HOME+"/Library/Application Support":process.env.HOME),os=require("os");class Settings{static id="settings";async init(config){this.config=config,this.database=await(new database).init(),this.initSettingsDefault(),this.initTab(),this.initAccount(),this.initRam(),this.initLauncherSettings()}initAccount(){document.querySelector(".accounts").addEventListener("click",(async e=>{let uuid=e.target.id,selectedaccount=await this.database.get("1234","accounts-selected");if(e.target.classList.contains("account")&&(console.log(uuid),accountSelect(uuid),this.database.update({uuid:"1234",selected:uuid},"accounts-selected")),e.target.classList.contains("account-delete")){if(this.database.delete(e.target.parentElement.id,"accounts"),document.querySelector(".accounts").removeChild(e.target.parentElement),!document.querySelector(".accounts").children.length)return void changePanel("login");if(uuid===selectedaccount.value.selected){let uuid=(await this.database.getAll("accounts"))[0].value.uuid;this.database.update({uuid:"1234",selected:uuid},"accounts-selected"),accountSelect(uuid)}}})),document.querySelector(".add-account").addEventListener("click",(()=>{document.querySelector(".cancel-login").style.display="contents",changePanel("login")}))}async initRam(){let ramDatabase=(await this.database.get("1234","ram"))?.value,totalMem=Math.trunc(os.totalmem()/1073741824*10)/10,freeMem=Math.trunc(os.freemem()/1073741824*10)/10;document.getElementById("total-ram").textContent=`${totalMem} Go`,document.getElementById("free-ram").textContent=`${freeMem} Go`,document.querySelector(".memory-slider").setAttribute("max",Math.trunc(80*totalMem/100));let ram=ramDatabase||{ramMin:"2",ramMax:"4"},slider=new Slider(".memory-slider",parseFloat(ram.ramMin),parseFloat(ram.ramMax)),minSpan=document.querySelector(".slider-touch-left span"),maxSpan=document.querySelector(".slider-touch-right span");minSpan.setAttribute("value",`${ram.ramMin} Go`),maxSpan.setAttribute("value",`${ram.ramMax} Go`),slider.on("change",((min,max)=>{minSpan.setAttribute("value",`${min} Go`),maxSpan.setAttribute("value",`${max} Go`),this.database.update({uuid:"1234",ramMin:`${min}`,ramMax:`${max}`},"ram")}))}async initJavaPath(){let javaDatabase=(await this.database.get("1234","java-path"))?.value?.path,javaPath=javaDatabase||"Utiliser la version de java livre avec le launcher";document.querySelector(".info-path").textContent=`${dataDirectory.replace(/\\/g,"/")}/${"darwin"==process.platform?this.config.dataDirectory:`.${this.config.dataDirectory}`}/runtime`;let path=document.querySelector(".path");path.value=javaPath;let file=document.querySelector(".path-file");document.querySelector(".path-button").addEventListener("click",(async()=>{file.value="",file.click(),await new Promise((resolve=>{let interval;interval=setInterval((()=>{""!=file.value&&resolve(clearInterval(interval))}),100)})),file.value.replace(".exe","").endsWith("java")||file.value.replace(".exe","").endsWith("javaw")?(this.database.update({uuid:"1234",path:file.value},"java-path"),path.value=file.value.replace(/\\/g,"/")):alert("Le nom du fichier doit Ãªtre java ou javaw")})),document.querySelector(".path-button-reset").addEventListener("click",(()=>{path.value="Utiliser la version de java livre avec le launcher",file.value="",this.database.update({uuid:"1234",path:!1},"java-path")}))}async initJavaArgs(){let javaArgsDatabase=(await this.database.get("1234","java-args"))?.value?.args,argsInput=document.querySelector(".args-settings");javaArgsDatabase?.length&&(argsInput.value=javaArgsDatabase.join(" ")),document.querySelector(".args-settings").addEventListener("change",(()=>{let args=[];try{if(argsInput.value.length){argsInput=argsInput.value.trim().split(/\s+/);for(let arg of argsInput)""!==arg&&"--server"!==arg&&"--port"!==arg&&args.push(arg)}}finally{this.database.update({uuid:"1234",args:args},"java-args")}}))}async initResolution(){let resolutionDatabase=(await this.database.get("1234","screen"))?.value?.screen,resolution=resolutionDatabase||{width:"1280",height:"720"},width=document.querySelector(".width-size");width.value=resolution.width;let height=document.querySelector(".height-size");height.value=resolution.height;let select=document.getElementById("select");select.addEventListener("change",(event=>{let resolution=select.options[select.options.selectedIndex].value.split(" x ");select.options.selectedIndex=0,width.value=resolution[0],height.value=resolution[1],this.database.update({uuid:"1234",screen:{width:resolution[0],height:resolution[1]}},"screen")}))}async initLauncherSettings(){let launcherDatabase=(await this.database.get("1234","launcher"))?.value,settingsLauncher={uuid:"1234",launcher:{close:launcherDatabase?.launcher?.close||"close-launcher"}},closeLauncher=document.getElementById("launcher-close"),closeAll=document.getElementById("launcher-close-all"),openLauncher=document.getElementById("launcher-open");"close-launcher"===settingsLauncher.launcher.close?closeLauncher.checked=!0:"close-all"===settingsLauncher.launcher.close?closeAll.checked=!0:"open-launcher"===settingsLauncher.launcher.close&&(openLauncher.checked=!0),closeLauncher.addEventListener("change",(()=>{closeLauncher.checked&&(openLauncher.checked=!1,closeAll.checked=!1),closeLauncher.checked||(closeLauncher.checked=!0),settingsLauncher.launcher.close="close-launcher",this.database.update(settingsLauncher,"launcher")})),closeAll.addEventListener("change",(()=>{closeAll.checked&&(closeLauncher.checked=!1,openLauncher.checked=!1),closeAll.checked||(closeAll.checked=!0),settingsLauncher.launcher.close="close-all",this.database.update(settingsLauncher,"launcher")})),openLauncher.addEventListener("change",(()=>{openLauncher.checked&&(closeLauncher.checked=!1,closeAll.checked=!1),openLauncher.checked||(openLauncher.checked=!0),settingsLauncher.launcher.close="open-launcher",this.database.update(settingsLauncher,"launcher")}))}initTab(){let TabBtn=document.querySelectorAll(".tab-btn"),TabContent=document.querySelectorAll(".tabs-settings-content");for(let i=0;i<TabBtn.length;i++)TabBtn[i].addEventListener("click",(()=>{if(!TabBtn[i].classList.contains("save-tabs-btn")){for(let j=0;j<TabBtn.length;j++)TabContent[j].classList.remove("active-tab-content"),TabBtn[j].classList.remove("active-tab-btn");TabContent[i].classList.add("active-tab-content"),TabBtn[i].classList.add("active-tab-btn")}}));document.querySelector(".save-tabs-btn").addEventListener("click",(()=>{document.querySelector(".default-tab-btn").click(),changePanel("home")}))}async initSettingsDefault(){(await this.database.getAll("accounts-selected")).length||this.database.add({uuid:"1234"},"accounts-selected"),(await this.database.getAll("java-path")).length||this.database.add({uuid:"1234",path:!1},"java-path"),(await this.database.getAll("java-args")).length||this.database.add({uuid:"1234",args:[]},"java-args"),(await this.database.getAll("launcher")).length||this.database.add({uuid:"1234",launcher:{close:"close-launcher"}},"launcher"),(await this.database.getAll("ram")).length||this.database.add({uuid:"1234",ramMin:"2",ramMax:"4"},"ram"),(await this.database.getAll("screen")).length||this.database.add({uuid:"1234",screen:{width:"1280",height:"720"}},"screen")}}export default Settings;
