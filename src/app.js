const{app:app,ipcMain:ipcMain}=require("electron"),{Microsoft:Microsoft}=require("minecraft-java-core"),{autoUpdater:autoUpdater}=require("electron-updater"),path=require("path"),fs=require("fs"),UpdateWindow=require("./assets/js/windows/updateWindow.js"),MainWindow=require("./assets/js/windows/mainWindow.js");let data,dev="dev"===process.env.NODE_ENV;if(dev){let appPath=path.resolve("./AppData/Launcher").replace(/\\/g,"/");fs.existsSync(appPath)||fs.mkdirSync(appPath,{recursive:!0}),app.setPath("userData",appPath)}const gotTheLock=app.requestSingleInstanceLock();gotTheLock?app.whenReady().then((()=>{UpdateWindow.createWindow()})):app.quit(),ipcMain.on("update-window-close",(()=>UpdateWindow.destroyWindow())),ipcMain.on("update-window-dev-tools",(()=>UpdateWindow.getWindow().webContents.openDevTools({mode:"detach"}))),ipcMain.on("main-window-open",(()=>MainWindow.createWindow())),ipcMain.on("main-window-dev-tools",(()=>MainWindow.getWindow().webContents.openDevTools({mode:"detach"}))),ipcMain.on("main-window-close",(()=>MainWindow.destroyWindow())),ipcMain.on("main-window-progress",((event,options)=>MainWindow.getWindow().setProgressBar(options.DL/options.totDL))),ipcMain.on("main-window-progress-reset",(()=>MainWindow.getWindow().setProgressBar(0))),ipcMain.on("main-window-minimize",(()=>MainWindow.getWindow().minimize())),ipcMain.on("main-window-maximize",(()=>{MainWindow.getWindow().isMaximized()?MainWindow.getWindow().unmaximize():MainWindow.getWindow().maximize()})),ipcMain.on("main-window-hide",(()=>MainWindow.getWindow().hide())),ipcMain.on("main-window-show",(()=>MainWindow.getWindow().show())),ipcMain.handle("Microsoft-window",(async(event,client_id)=>await new Microsoft(client_id).getAuth())),app.on("window-all-closed",(()=>{"darwin"!==process.platform&&app.quit()})),autoUpdater.autoDownload=!1,ipcMain.handle("update-app",(()=>new Promise((async(resolve,reject)=>{autoUpdater.checkForUpdates().then((()=>{resolve()})).catch((error=>{resolve({error:!0,message:error})}))})))),autoUpdater.on("update-available",(()=>{const updateWindow=UpdateWindow.getWindow();updateWindow&&updateWindow.webContents.send("updateAvailable")})),ipcMain.on("start-update",(()=>{autoUpdater.downloadUpdate()})),autoUpdater.on("update-not-available",(()=>{const updateWindow=UpdateWindow.getWindow();updateWindow&&updateWindow.webContents.send("update-not-available")})),autoUpdater.on("update-downloaded",(()=>{autoUpdater.quitAndInstall()})),autoUpdater.on("download-progress",(progress=>{const updateWindow=UpdateWindow.getWindow();updateWindow&&updateWindow.webContents.send("download-progress",progress)}));
